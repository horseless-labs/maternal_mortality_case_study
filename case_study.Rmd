---
title: "maternal_mortality_case_study"
output: html_document
date: "2022-10-04"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(root.dir = "/home/mireles/horseless/maternal_mortality/mortality")
```

Here, we load necessary libraries:

```{r, warning=FALSE}
library(tidyverse)
library(dplyr)
library(ggplot2)
```
It's pertinent to verify that we are in the right working directory.

```{r}
getwd()
```
Because the dataset is loaded as characters, there are columns that need to be converted to other datatypes. Many of these are factors instead of characters. There are also some columns that need to be added for the sake of processing later. Because we are combining many years worth of data, that is a variable to keep track of. Additionally, the ICD-10 codes are externally grouped into larger groups that we will find useful later.

```{r}
preprocess_dataset <- function(mort, year=0) {
  mort$res_status <- as_factor(mort$res_status)
  mort$education <- as_factor(mort$education)
  mort$age <- as.numeric(mort$age)
  mort$month <- as.numeric(mort$month)
  mort$death_loc <- as_factor(mort$death_loc)
  mort$marital_status <- as_factor(mort$marital_status)
  mort$race <- as_factor(mort$race)
  mort$hisp_orig <- as_factor(mort$hisp_orig)
  mort$hisp_orig_race <- as_factor(mort$hisp_orig_race)
  
  mort <- mort %>%
    mutate(age = replace(age, age == 999, NA))
  
  if (year != 0) {
    mort <- mort %>% add_column(year=year, .after="month")
    mort$year <- as_factor(mort$year)
  }
  
  return(mort)
}
```

Loading all data, processing it, and combining it into one variable.

```{r, warning=FALSE, message=FALSE}
mort2019 <- read_csv("maternal_mortality_2019.csv")
mort2019 <- preprocess_dataset(mort2019, 2019)

mort2018 <- read_csv("maternal_mortality_2018.csv")
mort2018 <- preprocess_dataset(mort2018, 2018)

mort2017 <- read_csv("maternal_mortality_2017.csv")
mort2017 <- preprocess_dataset(mort2017, 2017)

mort2016 <- read_csv("maternal_mortality_2016.csv")
mort2016 <- preprocess_dataset(mort2016, 2016)

mort2015 <- read_csv("maternal_mortality_2015.csv")
mort2015 <- preprocess_dataset(mort2015, 2015)

mort2014 <- read_csv("maternal_mortality_2014.csv")
mort2014 <- preprocess_dataset(mort2014, 2014)

mort2013 <- read_csv("maternal_mortality_2013.csv")
mort2013 <- preprocess_dataset(mort2013, 2013)

mort2012 <- read_csv("maternal_mortality_2012.csv")
mort2012 <- preprocess_dataset(mort2012, 2012)

mort2011 <- read_csv("maternal_mortality_2011.csv")
mort2011 <- preprocess_dataset(mort2011, 2011)

mort2010 <- read_csv("maternal_mortality_2010.csv")
mort2010 <- preprocess_dataset(mort2010, 2010)

mort2009 <- read_csv("maternal_mortality_2009.csv")
mort2009 <- preprocess_dataset(mort2009, 2009)

mort2008 <- read_csv("maternal_mortality_2008.csv")
mort2008 <- preprocess_dataset(mort2008, 2008)

mort2007 <- read_csv("maternal_mortality_2007.csv")
mort2007 <- preprocess_dataset(mort2007, 2007)

mort2006 <- read_csv("maternal_mortality_2006.csv")
mort2006 <- preprocess_dataset(mort2006, 2006)

mort2005 <- read_csv("maternal_mortality_2005.csv")
mort2005 <- preprocess_dataset(mort2005, 2005)

mort2004 <- read_csv("maternal_mortality_2004.csv")
mort2004 <- preprocess_dataset(mort2004, 2004)

mort2003 <- read_csv("maternal_mortality_2003.csv")
mort2003 <- preprocess_dataset(mort2003, 2003)

mort_combined <- bind_rows(mort2019, mort2018, mort2017, mort2016,
                          mort2015, mort2014, mort2013, mort2012,
                          mort2011, mort2010, mort2009, mort2008,
                          mort2007, mort2006, mort2005, mort2004,
                          mort2003)
```